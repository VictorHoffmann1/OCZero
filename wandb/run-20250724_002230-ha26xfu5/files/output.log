[main process] Initializing Global storage server...
[main process] Global storage server has been started from main process.
[main process] Batch storage has been initialized.
[main process] Replay buffer server has been started from main process.
[Watchdog Server] Watchdog server initialized.
[main process] Watchdog server has been started from main process.
[Data worker] Start data worker 0 at process 29902.
[main process] Data workers have all been launched.
[Batch worker GPU] Starting batch worker GPU 0 at process 29902.
[main process] Batch workers have all been launched.
[main process] torch version is 2.4.1+cu121, enabled torch_compile.
[2025-07-24 00:22:33,402][Train][INFO] - config: {'root_dir': '.', 'exp_config': 'ez/config/exp/atari.yaml', 'tag': 'EZ-V2', 'debug': False, 'save_path': 'results/Atari/Asterix/EZ-V2-seed=0-2025-07-24 00:22:27/', 'agent_name': 'atari_agent', 'env': {'env': 'Atari', 'game': 'Asterix', 'base_seed': 0, 'n_skip': 4, 'n_stack': 4, 'max_episode_steps': 3000, 'gray_scale': False, 'image_based': True, 'clip_reward': True, 'obs_shape': [3, 96, 96], 'episodic': True, 'action_space_size': 9}, 'rl': {'discount': 0.988053892081, 'unroll_steps': 5, 'td_steps': 5, 'auto_td_steps': 30000, 'td_lambda': 0.95}, 'optimizer': {'type': 'SGD', 'lr': 0.2, 'lr_decay_type': 'none', 'lr_warm_up': 0.01, 'lr_decay_rate': 0.1, 'lr_decay_steps': 100000, 'weight_decay': 0.0001, 'momentum': 0.9}, 'priority': {'use_priority': True, 'priority_prob_alpha': 1.0, 'priority_prob_beta': 1.0, 'min_prior': 1e-06}, 'train': {'load_model_path': '', 'batch_size': 128, 'training_steps': 100000, 'offline_training_steps': 20000, 'start_transitions': 1000, 'eval_n_episode': 10, 'eval_interval': 10000, 'self_play_update_interval': 1, 'reanalyze_update_interval': 1, 'save_ckpt_interval': 10000, 'mini_batch_size': 128, 'reanalyze_ratio': 1.0, 'reward_loss_coeff': 1.0, 'value_loss_coeff': 0.5, 'policy_loss_coeff': 1.0, 'consistency_coeff': 5.0, 'decorrelation_coeff': 0.01, 'off_diag_coeff': 0.005, 'entropy_coeff': 0.005, 'max_grad_norm': 5, 'change_temperature': True, 'periodic_reset': False, 'value_reanalyze': False, 'path_consistency': False, 'use_decorrelation': False, 'value_policy_detach': False, 'optimal_Q': False, 'v_num': 1, 'value_target': 'mixed', 'use_IQL': False, 'IQL_weight': 0.7, 'start_use_mix_training_steps': 30000.0, 'mixed_value_threshold': 5000.0}, 'data': {'num_envs': 1, 'buffer_size': 500000, 'total_transitions': 50000, 'top_transitions': 100000.0, 'trajectory_size': 200, 'save_video': False, 'save_as_dataset': False}, 'mcts': {'language': 'cython', 'num_simulations': 4, 'num_top_actions': 4, 'c_visit': 50, 'c_scale': 0.1, 'c_base': 19652, 'c_init': 1.25, 'dirichlet_alpha': 0.3, 'explore_frac': 0.25, 'value_minmax_delta': 0.01, 'vis': ['print'], 'mpc_horizon': 1, 'use_gumbel': True}, 'model': {'noisy_net': False, 'action_embedding': True, 'action_embedding_dim': 16, 'down_sample': True, 'state_norm': False, 'value_prefix': True, 'value_target': 'bootstrapped', 'GAE_max_steps': 15, 'init_zero': True, 'num_blocks': 1, 'num_channels': 64, 'reduced_channels': 16, 'projection_layers': [128, 128], 'prjection_head_layers': [64, 128], 'fc_layers': [32], 'lstm_hidden_size': 64, 'lstm_horizon_len': 5, 'policy_loss_type': 'reanalyze', 'reward_support': {'range': [-300, 300], 'scale': 1, 'env': 'Atari', 'bins': 51, 'type': 'support', 'size': 601}, 'value_support': {'range': [-300, 300], 'scale': 1, 'env': 'Atari', 'bins': 51, 'type': 'support', 'size': 601}}, 'actors': {'data_worker': 1, 'batch_worker': 1}, 'wandb': {'project': 'ez-v2-release', 'tag': 'Atari'}, 'augmentation': ['shift', 'intensity'], 'ddp': {'world_size': 1, 'training_size': 1, 'address': '127.0.0.1'}, 'ray': {'single_process': True}, 'log': {'log_interval': 100, 'log_smos': False}, 'eval': {'verbose': 0, 'save_path': 'test', 'model_path': 'results/Atari/Breakout/EZ-V2-seed=0-2023-08-10 00:40:53/models/model_10000.p', 'model_path_new': 'results/Atari/Breakout/EZ-V2-seed=0-2023-08-10 00:40:53/models/model_80000.p', 'n_episodes': 10, 'compare_value': False, 'analysis_value': False}}
[2025-07-24 00:22:33,402][Train][INFO] - save model in: results/Atari/Asterix/EZ-V2-seed=0-2025-07-24 00:22:27/models
/home/victo/projects/EfficientZeroV2/ez/agents/base.py:126: FutureWarning: `torch.cuda.amp.GradScaler(args...)` is deprecated. Please use `torch.amp.GradScaler('cuda', args...)` instead.
  scaler = GradScaler()
[36m(pid=30060)[39m free(): double free detected in tcache 2
[36m(pid=30060)[39m *** Aborted at 1753309355 (unix time) try "date -d @1753309355" if you are using GNU date ***
[36m(pid=30060)[39m PC: @                0x0 (unknown)
[36m(pid=30060)[39m *** SIGABRT (@0x3e80000756c) received by PID 30060 (TID 0x7f28bc485b80) from PID 30060; stack trace: ***
[36m(pid=30060)[39m     @     0x7f28bc5b5330 (unknown)
[36m(pid=30060)[39m     @     0x7f28bc60eb2c pthread_kill
[36m(pid=30060)[39m     @     0x7f28bc5b527e gsignal
[36m(pid=30060)[39m     @     0x7f28bc5988ff abort
[36m(pid=30060)[39m     @     0x7f28bc5997b6 (unknown)
[36m(pid=30060)[39m     @     0x7f28bc618ff5 (unknown)
[36m(pid=30060)[39m     @     0x7f28bc61b55f (unknown)
[36m(pid=30060)[39m     @     0x7f28bc61ddae __libc_free
[36m(pid=30060)[39m     @     0x7f25ab315e45 (unknown)
[36m(pid=30060)[39m     @     0x7f25ab329889 (unknown)
[36m(pid=30060)[39m     @     0x7f25ab153bcd (unknown)
[36m(pid=30060)[39m     @     0x7f25ab154fc5 (unknown)
[36m(pid=30060)[39m     @     0x7f25ab115264 (unknown)
[36m(pid=30060)[39m     @     0x7f25ab1ae812 (unknown)
[36m(pid=30060)[39m     @     0x7f25ab13a71b cuInit
[36m(pid=30060)[39m     @     0x7f28b02332e1 (unknown)
[36m(pid=30060)[39m     @     0x7f28b0236318 (unknown)
[36m(pid=30060)[39m     @     0x7f28bc611ed3 (unknown)
[36m(pid=30060)[39m     @     0x7f28b02786e9 (unknown)
[36m(pid=30060)[39m     @     0x7f28b0227a67 (unknown)
[36m(pid=30060)[39m     @     0x7f28b0249811 cudaGetDeviceCount
[36m(pid=30060)[39m     @     0x7f28b63a747a c10::cuda::device_count()
[36m(pid=30060)[39m     @     0x7f26854ff9b3 THCPModule_getDeviceCount_wrap()
[36m(pid=30060)[39m     @     0x7f28bc8736fd cfunction_vectorcall_NOARGS
[36m(pid=30060)[39m     @     0x7f28bc803947 _PyEval_EvalFrameDefault
[36m(pid=30060)[39m     @     0x7f28bc7fb18b function_code_fastcall
[36m(pid=30060)[39m     @     0x7f28bc803947 _PyEval_EvalFrameDefault
[36m(pid=30060)[39m     @     0x7f28bc9106e2 _PyEval_EvalCodeWithName
[36m(pid=30060)[39m     @     0x7f28bc910a5f PyEval_EvalCodeEx
[36m(pid=30060)[39m     @     0x7f28bc910a8f PyEval_EvalCode
[36m(pid=30060)[39m     @     0x7f28bc90c63d builtin_exec
[36m(pid=30060)[39m     @     0x7f28bc8735e7 cfunction_vectorcall_FASTCALL
[36m(pid=30055)
[36m(pid=30041)
[36m(pid=30046)
[36m(pid=30055)[39m /home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/wandb/analytics/sentry.py:82: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
[36m(pid=30055)[39m   self.hub = sentry_sdk.Hub(client)
[36m(pid=30041)[39m /home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/wandb/analytics/sentry.py:82: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
[36m(pid=30041)[39m   self.hub = sentry_sdk.Hub(client)
[36m(pid=30046)[39m /home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/wandb/analytics/sentry.py:82: SentryHubDeprecationWarning: `sentry_sdk.Hub` is deprecated and will be removed in a future major release. Please consult our 1.x to 2.x migration guide for details on how to migrate `Hub` usage to the new API: https://docs.sentry.io/platforms/python/migration/1.x-to-2.x
[36m(pid=30046)[39m   self.hub = sentry_sdk.Hub(client)
[36m(pid=30055)[39m /home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/kornia/feature/lightglue.py:44: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
[36m(pid=30055)[39m   @torch.cuda.amp.custom_fwd(cast_inputs=torch.float32)
[36m(pid=30041)[39m /home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/kornia/feature/lightglue.py:44: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
[36m(pid=30041)[39m   @torch.cuda.amp.custom_fwd(cast_inputs=torch.float32)
[36m(pid=30046)[39m /home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/kornia/feature/lightglue.py:44: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
[36m(pid=30046)[39m   @torch.cuda.amp.custom_fwd(cast_inputs=torch.float32)
[36m(pid=30041)[39m A.L.E: Arcade Learning Environment (version 0.7.5+db37282)
[36m(pid=30041)[39m [Powered by Stella]
2025-07-24 00:23:10,108	WARNING worker.py:1072 -- A worker died or was killed while executing task ffffffffffffffffdf5a1a8201000000.
[36m(pid=30041)[39m E0724 00:23:10.104916 30041 30209 task_manager.cc:323] Task failed: IOError: cancelling all pending tasks of dead actor: Type=ACTOR_TASK, Language=PYTHON, Resources: {CPU: 1, }, function_descriptor={type=PythonFunctionDescriptor, module_name=ez.data.global_storage, class_name=GlobalStorage, function_name=get_counter, function_hash=}, task_id=657918c9f8742103df5a1a8201000000, task_name=GlobalStorage.get_counter(), job_id=01000000, num_args=0, num_returns=2, actor_task_spec={actor_id=df5a1a8201000000, actor_caller_id=ffffffffffffffff88866c7d01000000, actor_counter=0}
[36m(pid=30055)[39m E0724 00:23:10.105399 30055 30185 task_manager.cc:323] Task failed: IOError: cancelling all pending tasks of dead actor: Type=ACTOR_TASK, Language=PYTHON, Resources: {CPU: 1, }, function_descriptor={type=PythonFunctionDescriptor, module_name=ez.data.global_storage, class_name=GlobalStorage, function_name=get_start_signal, function_hash=}, task_id=27e78df685bf8a06df5a1a8201000000, task_name=GlobalStorage.get_start_signal(), job_id=01000000, num_args=0, num_returns=2, actor_task_spec={actor_id=df5a1a8201000000, actor_caller_id=ffffffffffffffff3bf0c85601000000, actor_counter=0}
[36m(pid=30046)[39m E0724 00:23:10.105612 30046 30197 task_manager.cc:323] Task failed: IOError: cancelling all pending tasks of dead actor: Type=ACTOR_TASK, Language=PYTHON, Resources: {CPU: 1, }, function_descriptor={type=PythonFunctionDescriptor, module_name=ez.data.global_storage, class_name=GlobalStorage, function_name=get_counter, function_hash=}, task_id=09f28c4e1b9c4adddf5a1a8201000000, task_name=GlobalStorage.get_counter(), job_id=01000000, num_args=0, num_returns=2, actor_task_spec={actor_id=df5a1a8201000000, actor_caller_id=ffffffffffffffff62223d8501000000, actor_counter=0}
2025-07-24 00:23:15,118	ERROR worker.py:1018 -- Possible unhandled error from worker: [36mray::DataWorker.run()[39m (pid=30041, ip=172.24.247.44)
  File "python/ray/_raylet.pyx", line 484, in ray._raylet.execute_task
  File "python/ray/_raylet.pyx", line 438, in ray._raylet.execute_task.function_executor
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/home/victo/projects/EfficientZeroV2/ez/worker/data_worker.py", line 75, in run
    trained_steps = ray.get(self.storage.get_counter.remote())
ray.exceptions.RayActorError: The actor died unexpectedly before finishing this task.
2025-07-24 00:23:15,118	ERROR worker.py:1018 -- Possible unhandled error from worker: [36mray::EvalWorker.run()[39m (pid=30046, ip=172.24.247.44)
  File "python/ray/_raylet.pyx", line 484, in ray._raylet.execute_task
  File "python/ray/_raylet.pyx", line 438, in ray._raylet.execute_task.function_executor
  File "/home/victo/projects/EfficientZeroV2/ez/worker/eval_worker.py", line 35, in run
    counter = ray.get(self.storage.get_counter.remote())
ray.exceptions.RayActorError: The actor died unexpectedly before finishing this task.
2025-07-24 00:23:15,118	ERROR worker.py:1018 -- Possible unhandled error from worker: [36mray::BatchWorker.run()[39m (pid=30055, ip=172.24.247.44)
  File "python/ray/_raylet.pyx", line 484, in ray._raylet.execute_task
  File "python/ray/_raylet.pyx", line 438, in ray._raylet.execute_task.function_executor
  File "/home/victo/projects/EfficientZeroV2/ez/worker/batch_worker.py", line 107, in run
    while not ray.get(self.storage.get_start_signal.remote()):
ray.exceptions.RayActorError: The actor died unexpectedly before finishing this task.
Traceback (most recent call last):
  File "ez/train.py", line 157, in <module>
    main()
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/hydra.py", line 119, in run
    ret = run_job(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "ez/train.py", line 49, in main
    start_ddp_trainer(0, config)
  File "ez/train.py", line 89, in start_ddp_trainer
    final_weights = train(rank, agent, manager, logger, config)
  File "ez/train.py", line 112, in train
    final_weights, final_model = agent.train(
  File "/home/victo/projects/EfficientZeroV2/ez/agents/base.py", line 130, in train
    time.sleep(1)
KeyboardInterrupt
Traceback (most recent call last):
  File "ez/train.py", line 157, in <module>
    main()
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/main.py", line 94, in decorated_main
    _run_hydra(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/utils.py", line 394, in _run_hydra
    _run_app(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/utils.py", line 457, in _run_app
    run_and_report(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/utils.py", line 220, in run_and_report
    return func()
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/utils.py", line 458, in <lambda>
    lambda: hydra.run(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/_internal/hydra.py", line 119, in run
    ret = run_job(
  File "/home/victo/.pyenv/versions/efficient_zero_v2/lib/python3.8/site-packages/hydra/core/utils.py", line 186, in run_job
    ret.return_value = task_function(task_cfg)
  File "ez/train.py", line 49, in main
    start_ddp_trainer(0, config)
  File "ez/train.py", line 89, in start_ddp_trainer
    final_weights = train(rank, agent, manager, logger, config)
  File "ez/train.py", line 112, in train
    final_weights, final_model = agent.train(
  File "/home/victo/projects/EfficientZeroV2/ez/agents/base.py", line 130, in train
    time.sleep(1)
KeyboardInterrupt